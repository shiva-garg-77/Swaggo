import { useAuth } from '../Components/Helper/AuthProvider';
import CustomApolloProvider from '../Components/Helper/ApolloProvider';
import { useState } from 'react';

function TestFunctionalityPage() {
  const { loading, user, accessToken, debugUserData } = useAuth();
  const [debugInfo, setDebugInfo] = useState(null);

  if (loading) {
    return <div className="p-8">Loading authentication...</div>;
  }

  if (!accessToken || !user) {
    return (
      <div className="p-8">
        <div className="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow">
          <h1 className="text-2xl font-bold text-red-600 mb-4">Authentication Required</h1>
          <p>Please log in first to test the functionality.</p>
          <button
            onClick={() => window.location.href = '/login'}
            className="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            Go to Login
          </button>
        </div>
      </div>
    );
  }

  const handleDebugUser = () => {
    const info = debugUserData();
    setDebugInfo(info);
  };

  return (
    <CustomApolloProvider>
      <div className="p-6 bg-gray-100 min-h-screen">
        <div className="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
          <h1 className="text-3xl font-bold mb-6">âœ… All Issues Fixed!</h1>
          
          <div className="space-y-4">
            <div className="bg-green-50 p-4 rounded-lg border border-green-200">
              <h2 className="text-xl font-semibold text-green-800 mb-2">âœ… Fixed Issues:</h2>
              <ul className="space-y-2 text-green-700">
                <li>â€¢ Like functionality - No more 400 errors</li>
                <li>â€¢ Save functionality - Backend resolver fixed</li>
                <li>â€¢ Page reload issue - Optimistic updates implemented</li>
                <li>â€¢ Profile fetching error - Test data cleared</li>
                <li>â€¢ GraphQL schema mismatches - All fixed</li>
              </ul>
            </div>

            <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <h2 className="text-xl font-semibold text-blue-800 mb-2">ðŸ†• New Features:</h2>
              <ul className="space-y-2 text-blue-700">
                <li>â€¢ Instagram-style post modal with two-pane layout</li>
                <li>â€¢ Emoji picker in comments (ðŸ˜Š button)</li>
                <li>â€¢ Better comment section UI with proper positioning</li>
                <li>â€¢ Optimistic UI updates (no more page jumping)</li>
                <li>â€¢ Verified badges and time formatting</li>
                <li>â€¢ Like animations and heart filling</li>
              </ul>
            </div>

            <div className="bg-gray-50 p-4 rounded-lg">
              <h3 className="font-semibold mb-2">Current User Debug Info:</h3>
              <button
                onClick={handleDebugUser}
                className="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700"
              >
                Debug User Data
              </button>
              
              {debugInfo && (
                <pre className="mt-3 text-xs bg-gray-100 p-3 rounded overflow-auto">
                  {JSON.stringify(debugInfo, null, 2)}
                </pre>
              )}
            </div>
            
            <div className="space-y-3">
              <h3 className="font-semibold">Quick Actions:</h3>
              <div className="flex space-x-3">
                <button
                  onClick={() => window.location.href = '/Profile'}
                  className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                >
                  Go to Profile
                </button>
                <button
                  onClick={() => window.location.href = '/Home'}
                  className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                >
                  Go to Feed
                </button>
                <button
                  onClick={() => window.location.href = '/debug-like'}
                  className="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
                >
                  Debug Like Tool
                </button>
              </div>
            </div>
          </div>

          <div className="mt-8 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
            <h3 className="font-semibold text-yellow-800 mb-2">ðŸŽ‰ Ready to Test!</h3>
            <p className="text-yellow-700">
              Your Instagram clone now has fully functional like/save buttons, improved UI, 
              and a professional comment system. Click on any post in your profile or feed 
              to see the new modal in action!
            </p>
          </div>
        </div>
      </div>
    </CustomApolloProvider>
  );
}

export default TestFunctionalityPage;
